<!DOCTYPE html>
<html lang="en">
<head>
  <title>Write, AGOL!</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="" />

  <!-- Calls for the ArcGIS api's CSs and JS library. -->
  <link rel="stylesheet" href="https://js.arcgis.com/4.25/esri/themes/light/main.css">
  <script src="https://js.arcgis.com/4.25/"></script>

  <!-- CSS to make full screen map. -->
  <style>  html,  body,  #viewDiv {  
    padding: 0;  
    margin: 0;  
    height: 100%;  
    width: 100%;  
    }

  /* Basemap Gallery styles */
  #viewDiv .esri-basemap-gallery {
    width: 200px; /* Default width */
    height: 200px; /* Default height */
  }

  /* Media query to make it responsive on mobile devices */
  @media (max-width: 600px) {
    #viewDiv .esri-basemap-gallery {
      width: 150px; /* Smaller width for mobile */
      height: 150px; /* Smaller height for mobile */
    }
  }

  </style> 

</head>

<body>
  <!-- <h1>Hello, world! I'm using Git!</h1> -->
  <!-- The div to display the map -->
  <div id="viewDiv"></div> 

  <!-- Adding required modules for a full screen map app. -->
  <script>  
  require([
    "esri/config", 
    "esri/Map", 
    "esri/views/MapView",
    "esri/widgets/BasemapGallery",
    "esri/portal/PortalItem",
    "esri/widgets/Locate",
    "esri/widgets/Search",
    "esri/widgets/Expand",
    "esri/Graphic",  
    "esri/layers/GraphicsLayer",
    "esri/layers/FeatureLayer"
  ], function(esriConfig, Map, MapView, BasemapGallery, PortalItem, Locate, Search, Expand, Graphic, GraphicsLayer, FeatureLayer) {
    
    // Log into the API
    esriConfig.apiKey = "AAPTxy8BH1VEsoebNVZXo8HurC-WNby9xVB5CaUbYmSkdtsZmMyGnfH1JuHkPFwFFSBd3Z-v-N7m_s6f1dmRgKVLamcFHqSo0cttTR09tKsFzmbXZUhJIfKzl2R6HLQtKWGyGlzHobrqUHrwEOtLR9miyCr3AH4LGIs4bD8J_IfjNZJFYZiID06JxdIjFa_CX5wLcu2d2_5Pr2huNg7-z1mKuSnOsU5nBktIt9t_XxG-4s-ytgy_1uafScxdrTypBn4BAT1_UUjVT5i4";
  
    // Create the map
    const map = new Map({
      // basemap: "arcgis-hillshade-dark" // Basemap layer service
      basemap: "arcgis-colored-pencil" // Basemap layer service
      // basemap: "arcgis-nova" // Basemap layer service
      // basemap: "streets" // Basemap layer service
    });

    // Try any of these: "arcgis-imagery", "arcgis-imagery-standard", "arcgis-imagery-labels", "arcgis-light-gray", "arcgis-dark-gray", "arcgis-navigation", "arcgis-navigation-night", "arcgis-streets", "arcgis-streets-night", "arcgis-streets-relief", "arcgis-topographic", "arcgis-oceans", "osm-standard", "osm-standard-relief", "osm-streets", "osm-streets-relief", "osm-light-gray", "osm-dark-gray", "arcgis-terrain", "arcgis-community", "arcgis-charted-territory", "arcgis-colored-pencil", "arcgis-nova", "arcgis-modern-antique", "arcgis-midcentury", "arcgis-newspaper", "arcgis-hillshade-light", "arcgis-hillshade-dark", "arcgis-human-geography", "arcgis-human-geography-dark"

    // Create the View
    const view = new MapView({
      map: map,
      center: [-91.101, 46.8536], // Longitude, latitude
      zoom: 13, // Zoom level
      // scale: 24000, // Scale 1:24,000
      container: "viewDiv", // Div element
      popupEnabled: true
    });

    // Adding the constructor for the Graphics Layer
    const graphicsLayer = new GraphicsLayer();
    map.add(graphicsLayer);

    // Defining the geometry of the point
    const point = {
      type: "point",
      longitude: -91.098541,
      latitude: 46.859670
    };

    // Defining the marker style
    const simpleMarkerSymbol = {
      type: "simple-marker",
      style: "x",
      color: [255,255, 255],  // Color of blues rock
      outline: {
        color: [5,5,5],
        width: 1
      }
    };

    // Defining popup properties
    const popupTemplate = {
      title: "{Name}",
      content: "{Description}"
    }  
    const attributes = {
      Name: "Cornucopia Artesian Well",
      Description: "A public artesian well in a covered structure that flows 24-7."
    }

    // Creating the point
    const pointGraphic = new Graphic({  
      geometry: point,  
      symbol: simpleMarkerSymbol  ,
      // Adding popup properties
      attributes: attributes,
      popupTemplate: popupTemplate
    });
 
    // Adding the point to the graphicsLayer
    graphicsLayer.add(pointGraphic);


    // Define the polyline geometry
    const polyline = {
      type: "polyline", // Polyline type
      paths: [
        [-91.168145, 46.841656], // Point 1 (Longitude, Latitude) 46.841656, -91.168145
        [-91.169254, 46.842293], // Point 2 46.842293, -91.169254
        [-91.169503, 46.842736], // Point 3 46.842736, -91.169503
        [-91.169033, 46.84375],  // Point 4 46.843757, -91.169033
        [-91.169422, 46.844245]  // Point 5 46.844245, -91.169422
      ]
    };

    // Define the line symbol (for the polyline)
    const simpleLineSymbol = {
      type: "simple-line",  // Symbol type
      color: [226, 119, 40],  // Line color (Orange)
      width: 4  // Line width
    };

    // Define popup properties
    const popupTemplatePoly = {
      title: "Walking Path",
      content: "This is a path for foot traffic only."
    };

    // Create the polyline graphic
    const polylineGraphic = new Graphic({
      geometry: polyline,
      symbol: simpleLineSymbol,
      popupTemplate: popupTemplatePoly  // Attach the popup to the graphic
    });

    // Add the polyline graphic to the graphicsLayer
    graphicsLayer.add(polylineGraphic);

    // Define a pop-up for cellTowerLayer
    const popupCellTowers = {
      "title": "Cell Towers",
      "content": "<b>Licensee:</b> {Licensee}<br><b>Tower Call Sign:</b> {Callsign}<br><b>County:</b> {LocCounty}<br>"
    }

    // Adding a constructor for a Cell Tower FeatureLayer
    // https://services2.arcgis.com/FiaPA4ga0iQKduv3/arcgis/rest/services/nationwide_efh_1/FeatureServer >> incorrect without the /0 at the end.
    const cellTowerLayer = new FeatureLayer({
      url: "https://services2.arcgis.com/FiaPA4ga0iQKduv3/arcgis/rest/services/Cellular_Towers_in_the_United_States_view/FeatureServer/0",
      //adding the popup here
      outFields: ["Licensee","Callsign","LocCounty"],
      popupTemplate: popupCellTowers
    });

    // Adding the FeatureLayer to the map. 
    map.add(cellTowerLayer);

    const airportRenderer = {
      "type": "simple",
      "symbol": {
        "type": "picture-marker",
        "url": "https://raw.githubusercontent.com/jkloppenburg5/Read-AGOL/main/local_airport_24dp_000000.png",
        "width": "18px",
        "height": "18px"
      }
    }
    
    // Airport labels
    const airportLabels = {
      symbol: {
        type: "text",
        color: "#AAAAAA",        // Black text
        // haloColor: "#AAAAAA",    // Grey halo
        haloSize: "2px",
        font: {
          size: "12px",
          family: "Arial", // "Noto Sans", "sans-serif",
          style: "normal",
          weight: "normal"
        }
      },
      labelPlacement: "above-center",
      labelExpressionInfo: {
        expression: "$feature.Fac_Name"
      }
    };

    // Adding a constructor for a airport FeatureLayer
    // https://services2.arcgis.com/FiaPA4ga0iQKduv3/arcgis/rest/services/nationwide_efh_1/FeatureServer >> incorrect without the /0 at the end.
    const airportLayer = new FeatureLayer({
      url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/US_Airports_JK/FeatureServer/0",
      renderer: airportRenderer,
      definitionExpression: "Fac_Type = 'AIRPORT'", //adding sql to filter for airports
      labelingInfo: [airportLabels] //adding the labels
      //adding the popup here
      // outFields: ["Licensee","Callsign","LocCounty"],
      // popupTemplate: popupCellTowers
    });

    // Adding the FeatureLayer to the map. 
    map.add(airportLayer);

    const seaplane = {
      "type": "simple",
      "symbol": {
        "type": "picture-marker",
        "url": "https://raw.githubusercontent.com/jkloppenburg5/Read-AGOL/main/seaplane1.png",
        "width": "24px",
        "height": "24px"
        }
    }
  
    // Seaplane labels
    const seaplaneLabels = {
      symbol: {
        type: "text",
        color: "#AAAAAA",        // Black text
        // haloColor: "#AAAAAA",    // Grey halo
        haloSize: "2px",
        font: {
          size: "12px",
          family: "Arial", // "Noto Sans", "sans-serif",
          style: "normal",
          weight: "normal"
        }
      },
      labelPlacement: "above-center",
      labelExpressionInfo: {
        expression: "$feature.Fac_Name"
      }
    };

    // Seaplane Base FeatureLayer
    const seaplaneLayer = new FeatureLayer({
      url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/US_Airports_JK/FeatureServer/0",
      renderer: seaplane,
      definitionExpression: "Fac_Type = 'SEAPLANE BASE'", // Filter only seaplane bases
      labelingInfo: [seaplaneLabels],
      outFields: ["Fac_Name"] // optional: fields for popup or labels
    });

    // Add the seaplane layer to the map
    map.add(seaplaneLayer);

    // Create the BasemapGallery widget
    const basemapGallery = new BasemapGallery({
      view: view, // Map view for the widget
      container: document.createElement("div") // Create a div to hold the widget
    });

    // Create the Expand widget to wrap the BasemapGallery
    const basemapGalleryExpand = new Expand({
      view: view, // MapView instance
      content: basemapGallery, // Set the BasemapGallery as content
      expandIconClass: "esri-icon-basemap", // Icon for the expand button (optional)
      expanded: false // Start collapsed (default)
    });

    // Add the BasemapGallery Expand widget to the bottom-right of the view
    view.ui.add(basemapGalleryExpand, "bottom-right");

    // Create the Locate widget
    const locateWidget = new Locate({
      view: view, // MapView instance
      useTracking: true // Enables continuous tracking (optional)
    });

    // Add the Locate widget to the top-right corner of the view
    view.ui.add(locateWidget, "top-left"); 

    // Create the Search widget with proper configuration
    const searchWidget = new Search({
      view: view,
      popupEnabled: true,
      popupOpenOnSelect: false,
      includeDefaultSources: true // This ensures default geocoding services are used
    });

    // Add the Search widget to the top-right corner
    view.ui.add(searchWidget, {
      position: "top-right",
      index: 0
    });
  
  });  
  </script>

</body>
</html>>
